{% comment %}Debug: Show what's in site.data{% endcomment %}
<pre>
Looking for work_id: {{ page.work_id }}

Data files found:
{% for pair in site.data %}
  File: {{ pair[0] }}
  {% if pair[1].works %}
    Works in this file:
    {% for w in pair[1].works %}
      - {{ w.id }}
    {% endfor %}
  {% else %}
    (No 'works' key found)
  {% endif %}
{% endfor %}
</pre>

{% assign work = nil %}
{% for pair in site.data %}
  {% if pair[1].works %}
    {% for w in pair[1].works %}
      {% if w.id == page.work_id %}
        {% assign work = w %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% if work == nil %}
  <p>Work not found.</p>
{% else %}
<h1>{{ work.title }}</h1>
<p>
  <strong>{{ work.author }}</strong>
  {% if work.year %} ({{ work.year }}){% endif %}
</p>

{% for item in work.structure %}
  <h2>{{ item.type | capitalize }} {{ item.number }}: {{ item.title.en }}</h2>
  {% if item.children %}
    <ul>
      {% for child in item.children %}
        <li>
          {{ child.type | capitalize }} {{ child.number }} —
          {{ child.title.en }}
          {% if child.links %}
            {% for link in child.links %}
              {% if link.site == "CCEL" %}
                —
                <a href="{{ link.url }}" target="_blank">
                  CCEL
                </a>
              {% endif %}
            {% endfor %}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endfor %}
{% endif %}
